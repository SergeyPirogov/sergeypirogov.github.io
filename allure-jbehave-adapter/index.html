<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Автоматизация рутины приоритетнее давления массой">
    <meta name="author" content="Сергей Пирогов">
    <meta name="HandheldFriendly" content="True" />

    <meta property="og:site_name" content="Заметки Автоматизатора">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Пишем Allure Jbehave адаптер">
    <meta property="og:image" content="../images/blog-logo.png"/>
    <meta name="referrer" content="origin">

       <meta property="og:description" content="Заметка о том, как я писал свой адаптер для интеграции Allure Yandex и JBehave."/>
    <link rel="canonical" href="http://automation-remarks.com"/>
    <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon">

    <title>Заметки Автоматизатора</title>

    <link href="../css/github.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Custom styles for this template -->
    <link href="../css/album.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">

    <script>
           (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
           (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
           m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
           })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

           ga('create', 'UA-57010828-1', 'auto');
           ga('send', 'pageview');
    </script>
  <body>
<header>
      <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
        <div class='container'>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/">Главная <span class="sr-only">(current)</span></a>
            </li>

          </ul>
          <ul class="navbar-nav">
             <li class="nav-item">
               <a class="nav-link" target=blank href="https://soundcloud.com/qaguild">Подкаст</a>
             </li>
             <li class="nav-item">
               <a class="nav-link" target=blank href="https://tttttt.me/automation_remarks">Телеграм</a>
             </li>
             <li class="nav-item">
               <a class="nav-link" href="/archive.html">Архив</a>
             </li>
          </ul>
        </div>
        </div>
      </nav>
</header>
	<div class="album py-5 bg-light">
       <div class="post-container container">
            <main class="content" role="main">
                <article class="post">
                    <div class="inner inner-post">
                        <div id="push">
                            <header class="post-header">
                                <span class="post-meta">
                                    <span class="post-author">
                                        <a href="/author/index.html">Сергей Пирогов</a>
                                    </span> |
                                    <span class="post-date">
                                        19/07/2015
                                    </span>
                                </span>
                                <div class="clear"></div>
                                <h1 class="post-title">Пишем Allure Jbehave адаптер</h1>
                            </header>

                            <section class="post-content">
                                <div class="paragraph">
<p>Заметка о том, как я писал свой адаптер для интеграции <strong>Allure Yandex</strong> и <strong>JBehave</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://hsto.org/getpro/habr/post_images/c43/a4d/cf7/c43a4dcf7aa2837e5136db9abd9b919a.jpg" alt="c43a4dcf7aa2837e5136db9abd9b919a">
</div>
</div>
<div class="paragraph">
<p>Для начала определим суть проблемы. Allure позволяет интегрироваться практически со всеми известными тест-ранерами. Примеры можно найти здесь. <strong>Jbehave</strong> в качестве тест-ранера использует <strong>JUnit</strong>. Вы можете без особых проблем использовать Allure и JBehave, ничего не изобретая. Но есть пару неудобств. Allure отображает в отчете текст шагов или имена методов, отмеченных аннотацией <strong>@Step</strong>. Меньше слов - пример:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@When("I perform some action")
@Step
public void shouldPerformSomeAction(){
//some code
}

@Then("I check that action completed")
@Step("I check that action completed")
public void shouldBeComplitedAction(){
//some code
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как вы можете заметить, в первом случае имя метода не совсем совпадает со Step definition, а во втором присутствует дублирование, что еще хуже. Конечно, можно использовать первый подход, но имя метода писать <strong>whenIperformSomeAction</strong>, но, как по мне, можно попробовать сделать лучше.</p>
</div>
<div class="paragraph">
<p>Идем на страничку Wiki сюда и пытаемся понять, как написать свой адаптер. Далее, как специалисты высоко полета, понимаем, что все реализуется через листенеры (так реализоваы практически все адаптеры, если посмотреть их сорс коды). Ищем такой листенер для JBehave. Он называется <strong>org.jbehave.core.reporters.StoryReporter</strong>. Если мы реализуем этот интерфейс, то получим кучу методов, см пример здесь. Вот собственно здесь мы и зацепимся. Подключаем <strong>allure-java-adaptor-api</strong> и реализовываем методы. Важно помнить: чтобы <strong>Allure</strong> сгенерировал <strong>xml</strong> файлы, из которых будет собираться отчет, нужно обязательно в методе, который отвечает за окончание тестового прогона, указать TestSuiteFinishedEvent. Мой листенер называется <strong>AllureReporter</strong>. Для того, чтобы подключить его к JBehave и начать получать отчеты, нужно просто пойти в класс-раннер (пример того, как выглядит, см здесь) и прописать там одну простую строку:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">  @Override
  public Configuration configuration() {
    return new MostUsefulConfiguration()
            .useStoryReporterBuilder(new StoryReporterBuilder().withReporters(new AllureReporter())
   ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вот и все, после запуска тестов в папке target/allure-results будут находиться сгенерированные xml файлы. Затем нужно просто собрать отчет.</p>
</div>
                            </section>

                            <footer class="post-footer">
                                   <div class="post-tags">
                                           <a class="btn btn-sm btn-outline-dark tag" href="/tags/Java.html">Java</a>
                                           <a class="btn btn-sm btn-outline-dark tag" href="/tags/Тест-фреймворк.html">Тест фреймворк</a>
                                   </div>

                            </footer>

                            <div class="row pl-3 pr-3 training-banner-container">
                                                                    <div class="col text-center pb-3 pt-2 training-banner">
                                                                        <a href="/trainings">Доступные тренинги по автоматизации тестирования: Java API, Java UI, Python API, Jenkins CI</a>
                                                                    </div>
                                                        </div>

                            <div class="sidebar-social">
                                <h5>Подпишись:</h5>
                                <ul>
                                <li>
                                <a href="https://tttttt.me/automation_remarks" class="telegram" target="_blank" rel="nofollow">
                                  <i class="fa fa-telegram" aria-hidden="true"></i>
                                  <span>Telegram</span>
                                </a>
                                </li>

                                <li>
                                <a href="https://soundcloud.com/qaguild" class="podcast" target="_blank" rel="nofollow">
                                  <i class="fa fa-podcast" aria-hidden="true"></i>
                                  <span>Подкаст</span>
                                </a>
                                </li>

                                <li>
                                <a href="https://www.youtube.com/channel/UCHtyBZ2XbtsRmNiAxh48RGg?view_as=subscriber" class="youtube" target="_blank" rel="nofollow">
                                <i class="fa fa-youtube-play" aria-hidden="true"></i>
                                  <span>Youtube</span>
                                </a>
                                </li>

                                <li>
                                   <a href="https://donatesystem.io/donate/automation_remarks" class="support" target="_blank" rel="9nofollow">
                                   <i class="fa fa-money" aria-hidden="true"></i>
                                      <span>Поддержать</span>
                                   </a>
                                </li>


                            </div>




                            <div class="row">
                                  <div class="col-md-12">
                                        <div class='related-posts-holder'>
                                             <h2 class="related-posts-header">Похожие заметки:</h2>
                                                 <div class="card-deck">

                                                        <div class="card bg-light mb-3">
                                                         <a class="linked-card rel-card h-100" target="blank" href="/2020/qaguild-s03e13/index.html">
                                                            <div class="related-card card-body d-flex flex-column">
                                                              <p class="card-text">
                                                                      <small class="text-muted"><span class="post-date">22 August 2020</span></small>
                                                              </p>
                                                              <h5 class="card-title">
                                                                  <!-- <a href="/2020/qaguild-s03e13/index.html"> -->
                                                                    QAGuild S03E12: Про Тест планы и тест стратегии в 2020 году
                                                                  <!-- </a> -->
                                                              </h5>

                                                              <!--
                                                              <p class="card-text">
                                                                   Подкаст про Тест планы и тест стратегии в 2020 году
                                                              </p>
                                                              -->
                                                              <!-- <a href="/2020/qaguild-s03e13/index.html" class="mt-auto card-link">
                                                                Читать<i class="fa fa-chevron-right ml-1"></i>
                                                              </a> -->
                                                            </div>
                                                            </a>
                                                        </div>


                                                        <div class="card bg-light mb-3">
                                                         <a class="linked-card rel-card h-100" target="blank" href="/2020/qaguild-s03e11/index.html">
                                                            <div class="related-card card-body d-flex flex-column">
                                                              <p class="card-text">
                                                                      <small class="text-muted"><span class="post-date">21 August 2020</span></small>
                                                              </p>
                                                              <h5 class="card-title">
                                                                  <!-- <a href="/2020/qaguild-s03e11/index.html"> -->
                                                                    QAGuild S03E11: Про релокацию в Эстонию
                                                                  <!-- </a> -->
                                                              </h5>

                                                              <!--
                                                              <p class="card-text">
                                                                   Подкаст про релокацию в Эстонию
                                                              </p>
                                                              -->
                                                              <!-- <a href="/2020/qaguild-s03e11/index.html" class="mt-auto card-link">
                                                                Читать<i class="fa fa-chevron-right ml-1"></i>
                                                              </a> -->
                                                            </div>
                                                            </a>
                                                        </div>


                                                        <div class="card bg-light mb-3">
                                                         <a class="linked-card rel-card h-100" target="blank" href="/2020/qaguild-s03e12/index.html">
                                                            <div class="related-card card-body d-flex flex-column">
                                                              <p class="card-text">
                                                                      <small class="text-muted"><span class="post-date">21 August 2020</span></small>
                                                              </p>
                                                              <h5 class="card-title">
                                                                  <!-- <a href="/2020/qaguild-s03e12/index.html"> -->
                                                                    QAGuild S03E12: Про релокацию в Эстонию
                                                                  <!-- </a> -->
                                                              </h5>

                                                              <!--
                                                              <p class="card-text">
                                                                   Подкаст про работу в Швейцарии
                                                              </p>
                                                              -->
                                                              <!-- <a href="/2020/qaguild-s03e12/index.html" class="mt-auto card-link">
                                                                Читать<i class="fa fa-chevron-right ml-1"></i>
                                                              </a> -->
                                                            </div>
                                                            </a>
                                                        </div>


                                                        <div class="card bg-light mb-3">
                                                         <a class="linked-card rel-card h-100" target="blank" href="/2020/qaguild-live36/index.html">
                                                            <div class="related-card card-body d-flex flex-column">
                                                              <p class="card-text">
                                                                      <small class="text-muted"><span class="post-date">18 August 2020</span></small>
                                                              </p>
                                                              <h5 class="card-title">
                                                                  <!-- <a href="/2020/qaguild-live36/index.html"> -->
                                                                    QAGuild live #36: Как использовать Moon для запуска Playwright тестов
                                                                  <!-- </a> -->
                                                              </h5>

                                                              <!--
                                                              <p class="card-text">
                                                                   В этом эпизоде поговорим про то, как настроить инфраструктуру для запуска Playwright и Selenium тестов
                                                              </p>
                                                              -->
                                                              <!-- <a href="/2020/qaguild-live36/index.html" class="mt-auto card-link">
                                                                Читать<i class="fa fa-chevron-right ml-1"></i>
                                                              </a> -->
                                                            </div>
                                                            </a>
                                                        </div>

                                                 </div>
                                         </div>
                                  </div>
                                  <div class="col-md-6">

                                  </div>
                            </div>
                        </div>
                    </div>
                </article>
            </main>
       </div>
    </div>
    <footer class="text-muted page-footer fixed-bottom">
      <div class="container">

      </div>
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-3.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="../js/popper.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/holder.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://w.soundcloud.com/player/api.js"></script>
    <script src="../js/script.js"></script>
    <script src="https://use.fontawesome.com/e0e0cff5da.js"></script>
    <script async src="https://cse.google.com/cse.js?cx=005666829887305506139:i4vgkrjldvk"></script>
    </body>
</html>